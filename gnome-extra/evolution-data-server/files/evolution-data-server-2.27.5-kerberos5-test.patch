--- evolution-data-server.orig/acinclude.m4	2009-08-07 12:46:43.879789614 +0100
+++ evolution-data-server/acinclude.m4	2009-08-07 12:47:47.229042156 +0100
@@ -524,3 +524,82 @@
   $1="$$1 $flags_supported"
 ])
 
+# -*- tab-width: 4; -*-
+# Configure paths for KRB5
+# by Steven Newbury <steve@snewbury.org.uk> 2009-07-06
+# Based upon nspr.m4 by Chris Seawood <cls@seawood.org> 2001-04-05
+# Based upon gtk.m4 (also PD) by Owen Taylor
+
+dnl AM_PATH_KRB5([MINIMUM-VERSION, [ACTION-IF-FOUND [, ACTION-IF-NOT-FOUND]]])
+dnl Test for KRB5, and define KRB5_CFLAGS and KRB5_LIBS
+AC_DEFUN([AM_PATH_KRB5],
+[dnl
+
+AC_ARG_WITH(krb5-prefix,
+	[  --with-krb5-prefix=PFX  Prefix where KRB5 is installed],
+	krb5_config_prefix="$withval",
+	krb5_config_prefix="")
+
+AC_ARG_WITH(krb5-exec-prefix,
+	[  --with-krb5-exec-prefix=PFX
+                          Exec prefix where KRB5 is installed],
+	krb5_config_exec_prefix="$withval",
+	krb5_config_exec_prefix="")
+
+	if test -n "$krb5_config_exec_prefix"; then
+		krb5_config_args="$krb5_config_args --exec-prefix=$krb5_config_exec_prefix"
+		if test -z "$KRB5_CONFIG"; then
+			KRB5_CONFIG=$krb5_config_exec_prefix/bin/krb5-config
+		fi
+	fi
+	if test -n "$krb5_config_prefix"; then
+		krb5_config_args="$krb5_config_args --prefix=$krb5_config_prefix"
+		if test -z "$KRB5_CONFIG"; then
+			KRB5_CONFIG=$krb5_config_prefix/bin/krb5-config
+		fi
+	fi
+
+	unset ac_cv_path_KRB5_CONFIG
+	AC_PATH_PROG(KRB5_CONFIG, krb5-config, no)
+	min_krb5_version=ifelse([$1], ,1.0,$1)
+	AC_MSG_CHECKING(for KRB5 - version >= $min_krb5_version)
+
+	no_krb5=""
+	if test "$KRB5_CONFIG" = "no"; then
+		no_krb5="yes"
+	else
+		KRB5_CFLAGS=`$KRB5_CONFIG $krb5_config_args --cflags`
+		KRB5_LIBS=`$KRB5_CONFIG $krb5_config_args --libs`
+		KRB5_PREFIX=`$KRB5_CONFIG $krb5_config_args --prefix`
+		KRB5_VENDOR=`$KRB5_CONFIG $krb5_config_args --vendor`
+
+		krb5_config_major_version=`$KRB5_CONFIG $krb5_config_args --version 2>&1| \
+			sed 's/^.*Kerberos.*\([[0-9]]\)\.\([[0-9]]\)/\1/'`
+		krb5_config_minor_version=`$KRB5_CONFIG $krb5_config_args --version 2>&1| \
+			sed 's/^.*Kerberos.*\([[0-9]]\)\.\([[0-9]]\)/\2/'`
+		min_krb5_major_version=`echo $min_krb5_version | \
+			sed 's/\([[0-9]]*\).\([[0-9]]*\)/\1/'`
+		min_krb5_minor_version=`echo $min_krb5_version | \
+			sed 's/\([[0-9]]*\).\([[0-9]]*\)/\2/'`
+		if test "$krb5_config_major_version" -ne "$min_krb5_major_version"; then
+			no_krb5="yes"
+		elif test "$krb5_config_major_version" -eq "$min_krb5_major_version" &&
+		     test "$krb5_config_minor_version" -lt "$min_krb5_minor_version"; then
+			no_krb5="yes"
+		fi
+	fi
+
+	if test -z "$no_krb5"; then
+		AC_MSG_RESULT(yes)
+		ifelse([$2], , :, [$2])     
+	else
+		AC_MSG_RESULT(no)
+	fi
+
+
+	AC_SUBST(KRB5_CFLAGS)
+	AC_SUBST(KRB5_LIBS)
+	AC_SUBST(KRB5_PREFIX)
+	AC_SUBST(KRB5_VENDOR)
+
+])
--- evolution-data-server_build_amd64/configure.ac	2009-08-07 14:25:01.122973595 +0100
+++ evolution-data-server_build_x86/configure.ac	2009-08-07 14:22:49.042794135 +0100
@@ -1167,6 +1167,10 @@
 dnl ********
 dnl Kerberos
 dnl ********
+AC_ARG_ENABLE(krb5,
+  AC_HELP_STRING( [--enable-krb5=@<:@yes/no@:>@],
+		  [Attempt to use Kerberos 5.]),
+  enable_krb5="$enableval", enable_krb5="yes")
 AC_ARG_WITH(krb5,
   AC_HELP_STRING( [--with-krb5=DIR],
 		  [Location of Kerberos 5 install dir]),
@@ -1254,8 +1258,15 @@
 		AC_MSG_RESULT([no])
 		AC_MSG_ERROR([You specified with krb5, but it was not found.])
 	fi
+elif test "x${enable_krb5}" != "xno"; then
+	AM_PATH_KRB5(1.7,
+		msg_krb5="yes ($KRB5_VENDOR)"
+		with_krb5="$KRB5_PREFIX"
+		KRB5_LDFLAGS="$KRB5_CFLAGS",
+		with_krb5="no"
+		AC_MSG_RESULT(	AC_MSG_WARN([krb5 support disabled])))
 else
-	AC_MSG_WARN([krb5 support disabled])
+		AC_MSG_RESULT(	AC_MSG_WARN([krb5 support disabled]))
 fi
 
 AM_CONDITIONAL(ENABLE_KRB5, test x$with_krb5 != xno)
